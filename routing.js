var Meta;!function(a){var b=function(){function a(){}return a.getFunctionName=function(a){var b=a.indexOf("(");return a.substring(9,b).trim()},a.getFunctionParameterNames=function(a){var b=a.indexOf("(")+1,c=a.indexOf(")"),d=a.substring(b,c).replace(/\s/g,"");return 0===d.length?void 0:d.split(",")},a.getFunctionBodyFlatStartString=function(a){var b=a.indexOf("{")+1;return a.substring(b).replace(/(\r)/g,"").replace(/(\n)/g,"").replace(/\s+'/g,"'")},a.getFunctionAnnotations=function(a){for(var b=a.split(";"),c=[],d=0;d<b.length;d++){var e=b[d];if(null==e.match(/^'.*'/))break;c.push(e)}return 0===c.length?void 0:c},a.getFunctionInfo=function(b){var c={};for(var d in b)if("function"==typeof b[d]){var e=b[d].toString(),f=a.getFunctionParameterNames(e),g=a.getFunctionAnnotations(a.getFunctionBodyFlatStartString(e));c[d]={parameters:f,annotations:g}}return c},a}();a.FunctionParser=b}(Meta||(Meta={}));var Meta;!function(a){var b=function(){function a(a,b,c,d){this.args=a,this.annotated=b,this.funcName=c,this.funcParamNames=d}return a}();a.AnnotationInfo=b}(Meta||(Meta={}));var Meta;!function(a){var b=function(){function a(){}return a.execute=function(){},a}();a.Annotation=b}(Meta||(Meta={}));var Meta;!function(a){var b=function(){function b(){b.__parseAnnotations(this)}return b.__parseAnnotations=function(b){var c=a.FunctionParser.getFunctionInfo(b);for(var d in c)if(c.hasOwnProperty(d)&&void 0!==c[d].annotations)for(var e=0;e<c[d].annotations.length;e++){var f,g=c[d].annotations[e].substr(1,c[d].annotations[e].length-2),h=g.indexOf("="),i=void 0;if(-1==h)f=g;else{f=g.substring(0,h);var j=g.substring(h+1,g.length);i=JSON.parse(j)}for(var k=f.split("."),l=window,m=0;m<k.length;m++){var n=k[m];l=l[n]}var o=new a.AnnotationInfo(i,b,d,c[d].parameters);l.execute(o)}},b}();a.Annotated=b}(Meta||(Meta={}));var Routing;!function(a){var b=function(){function a(){}return a.getNumberOrString=function(a){if(isNaN(a))return a;var b=parseFloat(a);return isFinite(b)?b:a},a.getRest=function(b){if(null==b.match(/(.+=.+&?)+/))return void 0;for(var c={},d=b.split("&"),e=0;e<d.length;e++){var f=d[e].split("="),g=f[0],h=a.getNumberOrString(f[1]);void 0===c[g]?c[g]=h:c[g].constructor===Array?c[g].push(c[g]):c[g]=[c[g],h]}return c},a.getRestOrNumberOrString=function(b){var c=a.getRest(b);return void 0===c&&(c=a.getNumberOrString(b)),c},a.getResource=function(b){if(null==b.match(/(.*\?.+;?)+/))return void 0;for(var c={},d=b.split(";"),e=0;e<d.length;e++){var f=d[e].split("?"),g=f[0],h=f[1],i=a.getRest(h);if(void 0!==i)void 0===c[g]?c[g]=i:c[g].constructor===Array?i[g].push(i):c[g]=[c[g],i];else{var j=a.getNumberOrString(h);void 0===c[g]?c[g]=j:c[g].constructor===Array?c[g].push(j):c[g]=[c[g],j]}}return c},a.cropStaticElementsFromLeft=function(a,b){if(a===b)return[];for(var c="",d=0;d<a.length;d++)d>=b.length?c+=a[d]:a[d]!=b[d]&&(c+=a[d]);return c=c.replace(/^\//,""),c.split("/")},a.getArguments=function(b,c){for(var d=[],e=a.cropStaticElementsFromLeft(b,c),f={},g=!1,h=0;h<e.length;h++){var i=e[h],j=a.getResource(i);if(void 0!==j){for(var k in j)j.hasOwnProperty(k)&&(void 0===f[k]?f[k]=j[k]:f[k].constructor===Array?f[k].push(j[k]):f[k]=[f[k],j[k]]);g=!0}else d.push(a.getRestOrNumberOrString(i))}return g&&d.unshift(f),d},a}();a.HashParser=b}(Routing||(Routing={}));var Routing;!function(a){var b=function(){function b(){}return b.executeRoutes=function(b,c,d,e){for(var f=b.match(d),g=a.HashParser.getArguments(b,c),h=!1,i=0;i<e.length;i++){var j=e[i];null!=f&&void 0!==j.hit?(j.hit.apply(j.context,g),h=!0):void 0!==j.miss&&j.miss.apply(j.context,g)}return h},b.onHashChanged=function(){var a=window.location.hash.substr(1);if(0!==a.length){var c=!1;for(var d in b.routesMap)if(b.routesMap.hasOwnProperty(d)){var e=b.routesMap[d],f=b.executeRoutes(a,d,b.routesMap[d].regex,e.routes);c=c||f}if(!c){var g=b.bypass;void 0!==g&&(c||void 0===g.hit?void 0!==g.miss&&g.miss.apply(g.context,[a]):g.hit.apply(g.context,[a]))}}},b.init=function(){window.onhashchange=b.onHashChanged,b._onload=window.onload,window.onload=null===window.onload?b.onHashChanged:function(a){b._onload(a),b.onHashChanged()}},b.addRoute=function(a){var b=this.routesMap;void 0===b[a.routeRegex]&&(b[a.routeRegex]={routes:[],regex:new RegExp("^"+a.routeRegex)}),b[a.routeRegex].routes.push(a)},b.removeRoute=function(a){var b=this.routesMap;for(var c in b)if(b.hasOwnProperty(c)){for(var d=b[c],e=-1,f=0;f<d.length;f++)d[f]===a&&(e=f);if(-1!=e){d.splice(e,1);break}}},b.routesMap={},b}();a.RouteManager=b,b.init()}(Routing||(Routing={}));var Routing;!function(a){var b=function(){function b(a,b,c,d,e){void 0===b&&(b=void 0),void 0===c&&(c=void 0),void 0===d&&(d=!0),void 0===e&&(e=void 0),this.routeRegex=a,this.hit=b,this.miss=c,this.context=e,this.isRegistered=!1,d&&this.register()}return b.prototype.register=function(){this.isRegistered||(a.RouteManager.addRoute(this),this.isRegistered=!0)},b.prototype.unregister=function(){a.RouteManager.removeRoute(this),this.isRegistered=!1},b}();a.Route=b}(Routing||(Routing={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Routing;!function(a){var b;!function(b){var c=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.getRegexPartForParam=function(a){var b;return b=null!=a.match(/^ressource/)?"/.*\\?.*":null!=a.match(/^rest/)?"/.*=.*":null!=a.match(/^int/)?"/\\d+":null!=a.match(/^float/)?"/\\d*\\.?\\d+":"/.+",null!=a.match(/Repetition/)&&(b="("+b+")+"),null!=a.match(/Optional/)&&(b="("+b+")?"),b},c.execute=function(b){var d,e=!0;if(void 0===b.annotated.__proto__.getRoutes&&(b.annotated.__proto__.getRoutes=function(){return void 0===b.annotated._routes&&(b.annotated._routes=[]),this._routes}),void 0===b.annotated.__proto__.registerAll&&(b.annotated.__proto__.registerAll=function(){for(var a=0;a<this._routes.length;a++)this._routes[a].register()}),void 0===b.annotated.__proto__.unregisterAll&&(b.annotated.__proto__.unregisterAll=function(){for(var a=0;a<this._routes.length;a++)this._routes[a].unregister()}),void 0===b.args){var f=b.annotated.constructor.name;if(void 0===f&&(f=Meta.FunctionParser.getFunctionName(b.annotated.constructor.toString())),d=f+"/"+b.funcName,void 0!==b.funcParamNames)for(var g=0;g<b.funcParamNames.length;g++)d+=c.getRegexPartForParam(b.funcParamNames[g])}else d=b.args.path,e=b.args.register!==!1;var h=b.annotated.getRoutes();h.push(new a.Route(d,b.annotated[b.funcName],b.annotated[b.funcName+"Miss"],e,b.annotated))},c}(Meta.Annotation);b.Route=c}(b=a.Annotations||(a.Annotations={}))}(Routing||(Routing={}));